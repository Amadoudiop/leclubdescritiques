{"version":3,"sources":["../../../../../../vendor/friendsofsymfony/jsrouting-bundle/Resources/js/router.js"],"names":["goog","provide","require","fos","Router","opt_context","opt_routes","context_","base_url","prefix","host","scheme","setRoutes","addSingletonGetter","Route","Context","prototype","routes","routes_","structs","Map","getRoutes","setBaseUrl","baseUrl","getBaseUrl","setPrefix","setScheme","getScheme","setHost","getHost","buildQueryParams","params","add","self","name","rbracket","RegExp","Array","array","forEach","val","i","test","getRoute","prefixedName","containsKey","Error","get","generate","opt_params","absolute","route","unusedParams","object","clone","url","optional","tokens","token","hasDefault","defaults","value","remove","empty","encodedValue","encodeURIComponent","replace","hosttokens","requirements","getCount","queryParams","key","push","join"],"mappings":"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","file":"router.js","sourcesContent":["goog.provide('fos.Router');\n\ngoog.require('goog.structs.Map');\ngoog.require('goog.array');\ngoog.require('goog.object');\ngoog.require('goog.uri.utils');\n\n/**\n * @constructor\n * @param {fos.Router.Context=} opt_context\n * @param {Object.<string, fos.Router.Route>=} opt_routes\n */\nfos.Router = function(opt_context, opt_routes) {\n    this.context_ = opt_context || {base_url: '', prefix: '', host: '', scheme: ''};\n    this.setRoutes(opt_routes || {});\n};\ngoog.addSingletonGetter(fos.Router);\n\n/**\n * @typedef {{\n *     tokens: (Array.<Array.<string>>),\n *     defaults: (Object.<string, string>),\n *     requirements: Object,\n *     hosttokens: (Array.<string>)\n * }}\n */\nfos.Router.Route;\n\n/**\n * @typedef {{\n *     base_url: (string)\n * }}\n */\nfos.Router.Context;\n\n/**\n * @param {Object.<string, fos.Router.Route>} routes\n */\nfos.Router.prototype.setRoutes = function(routes) {\n    this.routes_ = new goog.structs.Map(routes);\n};\n\n/**\n * @return {Object.<string, fos.Router.Route>} routes\n */\nfos.Router.prototype.getRoutes = function() {\n    return this.routes_;\n};\n\n/**\n * @param {string} baseUrl\n */\nfos.Router.prototype.setBaseUrl = function(baseUrl) {\n    this.context_.base_url = baseUrl;\n};\n\n/**\n * @return {string}\n */\nfos.Router.prototype.getBaseUrl = function() {\n    return this.context_.base_url;\n};\n\n/**\n * @param {string} prefix\n */\nfos.Router.prototype.setPrefix = function(prefix) {\n    this.context_.prefix = prefix;\n};\n\n/**\n * @param {string} scheme\n */\nfos.Router.prototype.setScheme = function(scheme) {\n    this.context_.scheme = scheme;\n};\n\n/**\n * @return {string}\n */\nfos.Router.prototype.getScheme = function() {\n    return this.context_.scheme;\n};\n\n/**\n * @param {string} host\n */\nfos.Router.prototype.setHost = function(host) {\n    this.context_.host = host;\n};\n\n/**\n * @return {string}\n */\nfos.Router.prototype.getHost = function() {\n    return this.context_.host;\n};\n\n\n/**\n * Builds query string params added to a URL.\n * Port of jQuery's $.param() function, so credit is due there.\n *\n * @param {string} prefix\n * @param {Array|Object|string} params\n * @param {Function} add\n */\nfos.Router.prototype.buildQueryParams = function(prefix, params, add) {\n    var self = this;\n    var name;\n    var rbracket = new RegExp(/\\[\\]$/);\n\n    if (params instanceof Array) {\n        goog.array.forEach(params, function(val, i) {\n            if (rbracket.test(prefix)) {\n                add(prefix, val);\n            } else {\n                self.buildQueryParams(prefix + '[' + (typeof val === 'object' ? i : '') + ']', val, add);\n            }\n        });\n    } else if (typeof params === 'object') {\n        for (name in params) {\n            this.buildQueryParams(prefix + '[' + name + ']', params[name], add);\n        }\n    } else {\n        add(prefix, params);\n    }\n};\n\n/**\n * Returns a raw route object.\n *\n * @param {string} name\n * @return {fos.Router.Route}\n */\nfos.Router.prototype.getRoute = function(name) {\n    var prefixedName = this.context_.prefix + name;\n    if (!this.routes_.containsKey(prefixedName)) {\n        // Check first for default route before failing\n        if (!this.routes_.containsKey(name)) {\n            throw new Error('The route \"' + name + '\" does not exist.');\n        }\n    } else {\n        name = prefixedName;\n    }\n\n    return (this.routes_.get(name));\n};\n\n\n/**\n * Generates the URL for a route.\n *\n * @param {string} name\n * @param {Object.<string, string>} opt_params\n * @param {boolean} absolute\n * @return {string}\n */\nfos.Router.prototype.generate = function(name, opt_params, absolute) {\n    var route = (this.getRoute(name)),\n        params = opt_params || {},\n        unusedParams = goog.object.clone(params),\n        url = '',\n        optional = true,\n        host = '';\n\n    goog.array.forEach(route.tokens, function(token) {\n        if ('text' === token[0]) {\n            url = token[1] + url;\n            optional = false;\n\n            return;\n        }\n\n        if ('variable' === token[0]) {\n            var hasDefault = goog.object.containsKey(route.defaults, token[3]);\n            if (false === optional || !hasDefault || (goog.object.containsKey(params, token[3]) && params[token[3]] != route.defaults[token[3]])) {\n                    var value;\n\n                    if (goog.object.containsKey(params, token[3])) {\n                        value = params[token[3]];\n                        goog.object.remove(unusedParams, token[3]);\n                    } else if (hasDefault) {\n                        value = route.defaults[token[3]];\n                    } else if (optional) {\n                        return;\n                    } else {\n                        throw new Error('The route \"' + name + '\" requires the parameter \"' + token[3] + '\".');\n                    }\n\n                    var empty = true === value || false === value || '' === value;\n\n                    if (!empty || !optional) {\n                        var encodedValue = encodeURIComponent(value).replace(/%2F/g, '/');\n\n                        if ('null' === encodedValue && null === value) {\n                            encodedValue = '';\n                        }\n\n                        url = token[1] + encodedValue + url;\n                    }\n\n                    optional = false;\n                } else if (hasDefault) {\n                    goog.object.remove(unusedParams, token[3]);\n                }\n\n                return;\n        }\n\n        throw new Error('The token type \"' + token[0] + '\" is not supported.');\n    });\n\n    if (url === '') {\n        url = '/';\n    }\n\n    goog.array.forEach(route.hosttokens, function (token) {\n        var value;\n\n        if ('text' === token[0]) {\n            host = token[1] + host;\n\n            return;\n        }\n\n        if ('variable' === token[0]) {\n            if (goog.object.containsKey(params, token[3])) {\n                value = params[token[3]];\n                goog.object.remove(unusedParams, token[3]);\n            } else if (goog.object.containsKey(route.defaults, token[3])) {\n                value = route.defaults[token[3]];\n            }\n\n            host = token[1] + value + host;\n        }\n    });\n\n    url = this.context_.base_url + url;\n    if (goog.object.containsKey(route.requirements, \"_scheme\") && this.getScheme() != route.requirements[\"_scheme\"]) {\n        url = route.requirements[\"_scheme\"] + \"://\" + (host || this.getHost()) + url;\n    } else if (host && this.getHost() !== host) {\n        url = this.getScheme() + \"://\" + host + url;\n    } else if (absolute === true) {\n        url = this.getScheme() + \"://\" + this.getHost() + url;\n    }\n\n    if (goog.object.getCount(unusedParams) > 0) {\n        var prefix;\n        var queryParams = [];\n        var add = function(key, value) {\n            // if value is a function then call it and assign it's return value as value\n            value = (typeof value === 'function') ? value() : value;\n\n            // change null to empty string\n            value = (value === null) ? '' : value;\n\n            queryParams.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n        };\n\n        for (prefix in unusedParams) {\n            this.buildQueryParams(prefix, unusedParams[prefix], add);\n        }\n\n        url = url + '?' + queryParams.join('&').replace(/%20/g, '+');\n    }\n\n    return url;\n};\n"]}