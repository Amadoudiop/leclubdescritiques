{% extends 'base.html.twig' %}

{% block body %}

    {% block stylesheet %}
        <link rel="stylesheet" type="text/css" href="{{ asset('css/theme.min.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ asset('css/font-entypo.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ asset('css/theme-responsive.min.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ asset('css/fonts.css') }}">
    {% endblock  %}
    
    <div class="container-fluid" id="salon">
        <div class="row">
        Salon : {{ salon.title }}
            <div class="col-lg-3">
                <div class="btn-panel btn-panel-conversation">
                    <a href="" class="btn  col-lg-6 send-message-btn " role="button"><i class="fa fa-search"></i> Search</a>
                    <a href="" class="btn  col-lg-6  send-message-btn pull-right" role="button"><i class="fa fa-plus"></i> New Message</a>
                </div>
            </div>

            <div class="col-lg-offset-1 col-lg-7">
                <div class="btn-panel btn-panel-msg">

                    <a href="" class="btn  col-lg-3  send-message-btn pull-right" role="button"><i class="fa fa-gears"></i> Settings</a>
                </div>
            </div>
        </div>
        <div class="row">

            <div class="conversation-wrap col-lg-3">
                {% for participant in participants %}
                <div class="media conversation">
                    <a class="pull-left" href="#">
                        <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 50px; height: 50px;" src="">
                    </a>
                    <div class="media-body">
                        <h5 class="media-heading">{{ participant.firstname }} {{ participant.lastname }}</h5>
                    </div>
                </div>
                {% endfor %}
            </div>



            <div class="message-wrap col-lg-8">
                <div class="msg-wrap">
                    {% for message in messages %}
                        <div class="media msg">
                            <a class="pull-left" href="#">
                                <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 32px; height: 32px;" src="">
                            </a>
                            <div class="media-body">
                                <small class="pull-right time"><i class="fa fa-clock-o"></i> {{ message.time|date('d-m-Y h:i:s') }}</small>    

                                <h5 class="media-heading">{{ message.user.firstname }} {{ message.user.lastname }}</h5>
                                <small class="col-lg-10">{{ message.message }}</small>
                            </div>
                        </div>
                    {% endfor %}

                </div>

                <div class="send-wrap ">

                    <textarea class="form-control send-message" rows="3" placeholder="Write a reply..." id="message"></textarea>


                </div>
                <div class="btn-panel">
                    <a href="" class=" col-lg-3 btn   send-message-btn " role="button"><i class="fa fa-cloud-upload"></i> Add Files</a>
                    <a href="" class=" col-lg-4 text-right btn   send-message-btn pull-right" role="button" id="sendMessage"><i class="fa fa-plus" ></i> Send Message</a>
                    <input type="button" id="form-submit" value="Send message" @click.stop.prevent="sendMessageChat"/>
                    <span id="username" class="hidden">{{ user.firstname }} {{ user.lastname }}</span>
            </div>
        </div>
    </div>
    <!-- Vue js star rating -->
    <script src="https://unpkg.com/vue-star-rating/dist/star-rating.min.js"></script>

    <!-- Socket -->
    <!--<script>

        // This object will be sent everytime you submit a message in the sendMessage function.
        var clientInformation = {
            username: new Date().getTime().toString()
            // You can add more information in a static object
        };
        
        // START SOCKET CONFIG
        /**
         * Note that you need to change the "sandbox" for the URL of your project. 
         * According to the configuration in Sockets/Chat.php , change the port if you need to.
         * @type WebSocket
         */
        var conn = new WebSocket('ws://localhost:9090/chat-01');    

        conn.onopen = function(e) {
            console.info("Connection established succesfully");
        };  

        conn.onmessage = function(e) {
            var data = JSON.parse(e.data);
            Chat.appendMessage(data.username, data.message);
            
            console.log(data);
        };
        
        conn.onerror = function(e){
            alert("Error: something went wrong with the socket.");
            console.error(e);
        };
        // END SOCKET CONFIG
       
        
        /// Some code to add the messages to the list element and the message submit.
        document.getElementById("form-submit").addEventListener("click",function(){
            var msg = document.getElementById("message").value;
            console.log(msg);
            alert(msg);
            
            if(!msg){
                alert("Please send something on the chat");
            }
            
            Chat.sendMessage(msg);
            // Empty text area
            document.getElementById("message").value = "";
        }, false);
        console.log('coucou1');
        // Mini API to send a message with the socket and append a message in a UL element.
        var Chat = {
            appendMessage: function(username,message){
                var from;
                
                if(username == clientInformation.username){
                    from = "me";
                }else{
                    from = clientInformation.username;
                }
                
                // Append List Item
                /*var ul = document.getElementById("chat-list");
                var li = document.createElement("li");
                li.appendChild(document.createTextNode(from + " : "+ message));
                ul.appendChild(li);*/
                $('.msg:last').append("<p> "+ from +"dit : " + message + "</p>");
            },
            sendMessage: function(text){
                clientInformation.message = text;
                // Send info as JSON
                conn.send(JSON.stringify(clientInformation));
                // Add my own message to the list
                this.appendMessage(clientInformation.username, clientInformation.message);
            }
        };
    </script>-->

{% endblock %}